<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cobb-Douglas Income Effect</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .slider-group {
      margin-bottom: 10px;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input[type="range"] {
      width: 300px;
    }
    #explanation {
      margin-top: 20px;
      padding: 10px;
      background: #f0f0f0;
      border-left: 5px solid #999;
    }
  </style>
</head>
<body>
  <h2>Income Effect — Cobb-Douglas Utility</h2>

  <div class="slider-group">
    <label>α (alpha): <span id="alphaVal">0.6</span>
      <input type="range" min="0.1" max="0.9" step="0.01" value="0.6" id="alphaSlider" />
    </label>
    <label>pₓ: <span id="pxVal">1.0</span>
      <input type="range" min="0.1" max="5" step="0.1" value="1" id="pxSlider" />
    </label>
    <label>pᵧ: <span id="pyVal">1.0</span>
      <input type="range" min="0.1" max="5" step="0.1" value="1" id="pySlider" />
    </label>
    <label>Income: <span id="incomeVal">10.0</span>
      <input type="range" min="1" max="25" step="0.5" value="10" id="incomeSlider" />
    </label>
  </div>

  <div id="plot" style="width: 100%; height: 500px;"></div>
  <div id="explanation"></div>

  <script>
    const alphaSlider = document.getElementById('alphaSlider');
    const pxSlider = document.getElementById('pxSlider');
    const pySlider = document.getElementById('pySlider');
    const incomeSlider = document.getElementById('incomeSlider');

    const alphaVal = document.getElementById('alphaVal');
    const pxVal = document.getElementById('pxVal');
    const pyVal = document.getElementById('pyVal');
    const incomeVal = document.getElementById('incomeVal');

    const explanation = document.getElementById('explanation');
    const plotDiv = document.getElementById('plot');

    const incomeInitial = 10;
    const pxInitial = 1;
    const pyInitial = 1;
    const alphaInitial = 0.6;

    function updatePlot() {
      const alpha = parseFloat(alphaSlider.value);
      const px = parseFloat(pxSlider.value);
      const py = parseFloat(pySlider.value);
      const income = parseFloat(incomeSlider.value);

      alphaVal.textContent = alpha.toFixed(2);
      pxVal.textContent = px.toFixed(2);
      pyVal.textContent = py.toFixed(2);
      incomeVal.textContent = income.toFixed(2);

      const xVals = Array.from({ length: 200 }, (_, i) => i * 0.1);

      const x0 = (incomeInitial / pxInitial) * alpha;
      const y0 = (incomeInitial / pyInitial) * (1 - alpha);
      const yBudget0 = xVals.map(x => {
        const y = (incomeInitial - pxInitial * x) / pyInitial;
        return y >= 0 ? y : null;
      });

      const x1 = (income / px) * alpha;
      const y1 = (income / py) * (1 - alpha);
      const yBudget1 = xVals.map(x => {
        const y = (income - px * x) / py;
        return y >= 0 ? y : null;
      });

      const traceFill = {
        x: [...xVals, xVals[xVals.length - 1], xVals[0]],
        y: [...yBudget1, 0, 0],
        fill: 'toself',
        fillcolor: 'rgba(0, 200, 255, 0.2)',
        line: { color: 'transparent' },
        type: 'scatter',
        mode: 'none',
        name: 'New Feasible Set',
        showlegend: true
      };

      const traceOriginalBudget = {
        x: xVals,
        y: yBudget0,
        mode: 'lines',
        name: 'Original Budget Line',
        line: { dash: 'dot', color: 'gray' }
      };

      const traceNewBudget = {
        x: xVals,
        y: yBudget1,
        mode: 'lines',
        name: 'New Budget Line',
        line: { color: 'black' }
      };

      const traceOriginalBundle = {
        x: [x0],
        y: [y0],
        mode: 'markers',
        name: 'Original Bundle',
        marker: { color: 'red', size: 10 }
      };

      const traceNewBundle = {
        x: [x1],
        y: [y1],
        mode: 'markers',
        name: 'New Bundle',
        marker: { color: 'green', size: 10 }
      };

      const layout = {
        title: `Income Effect — α = ${alpha.toFixed(2)}, pₓ = ${px.toFixed(2)}, pᵧ = ${py.toFixed(2)}, I = ${income.toFixed(2)}`,
        xaxis: { title: 'Good X', range: [0, 20] },
        yaxis: { title: 'Good Y', range: [0, 20] },
        legend: { x: 0, y: -0.2, orientation: 'h' },
        margin: { t: 50, b: 70 }
      };

      Plotly.newPlot(plotDiv, [
        traceFill,
        traceNewBudget,
        traceOriginalBudget,
        traceOriginalBundle,
        traceNewBundle
      ], layout, { responsive: true });

      // Explanation logic
      explanation.innerHTML = '';
      if (income !== incomeInitial) {
        explanation.innerHTML += `<p>Income has ${income > incomeInitial ? 'increased' : 'decreased'} from ${incomeInitial} to ${income}, which ${income > incomeInitial ? 'expands' : 'shrinks'} the feasible set.</p>`;
      }
      if (px !== pxInitial) {
        explanation.innerHTML += `<p>The price of Good X has ${px > pxInitial ? 'increased' : 'decreased'} from ${pxInitial} to ${px}, affecting the consumption of Good X.</p>`;
      }
      if (py !== pyInitial) {
        explanation.innerHTML += `<p>The price of Good Y has ${py > pyInitial ? 'increased' : 'decreased'} from ${pyInitial} to ${py}, affecting the consumption of Good Y.</p>`;
      }
    }

    // Initial plot and listeners
    [alphaSlider, pxSlider, pySlider, incomeSlider].forEach(slider =>
      slider.addEventListener('input', updatePlot)
    );
    updatePlot();
  </script>
</body>
</html>
